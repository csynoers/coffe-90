<template>
    <div class="page" data-name="home">
        <!-- Top Navbar -->
        <div class="navbar">
            <div class="navbar-bg"></div>
            <div class="navbar-inner sliding">
            <div class="left">
                <a href="#" class="link icon-only panel-open" data-panel="left">
                <i class="icon material-icons if-md">menu</i>
                </a>
            </div>
            <div class="title">Coffe's 90</div>
            <div class="right">
                <a href="/logout/" class="link icon-only">
                    <img src="static/icons/logout.jpg" alt="" style="height: 20px;" />
                </a>
            </div>
            </div>
        </div>
        <!-- Toolbar-->
        <div class="toolbar toolbar-bottom">
            <div class="text-align-center">
                <p>@coffe's 90</p>
            </div>
        </div>
        <!-- Scrollable page content-->
        <div class="page-content">
            <div class="block">
                <p class="text-align-center">
                    <a href="#" class="button button-outline button-round button-small icon-only" @click="${refreshPage}">
                        <i class="icon material-icons margin-right-half"></i>
                        Klik disini untuk menyegarkan halaman
                    </a>
                </p>
                <div>
                    ${menu_belum_siap.value.length > 0 ? $h`
                        <div class="block-title">Daftar Pesanan :</div>
                        ${menu_belum_siap.value.map((item) => $h`
                            <div class="card card-outline ambil-daftar-pesanan-dapur" @click="${()=>ubahStatusBelumSiap(item)}">
                                <div class="card-content card-content-padding">
                                    <div>Meja no: ${item.nomor_meja}</div>
                                    <div>Nama Menu: ${item.nama_menu}</div>
                                    <div>Jumlah: ${item.jumlah}</div>
                                    <div>Keterangan: ${item.keterangan}</div>
                                </div>
                            </div>
                        `)}
                    ` : $h`
                        <div class="block block-strong text-align-center">
                            <p>
                                Belum ada Pesanan
                            </p>
                        </div>
                    `}
                </div>
            </div>
        </div>
    </div>
</template>
<script>
export default (props,{ $f7, $on, $store, $f7route, $f7router, $update, $onMounted }) => {
    const url = $store.getters.url.value;

    const $ = $f7.$;
    const menu_belum_siap = $store.getters.menu_belum_siap;

    const refreshPage = () => {
        $f7router.navigate('/home-dapur/',{reloadCurrent  : true});
    }

    const ubahStatusBelumSiap = (i) => {
        
        let formData = {
            'status_pesanan_detail' : 'Siap'
        };

        $f7.request.post(`${url}/detail/update/${i.id_pesanan_detail}`, {'data':JSON.stringify(formData)})
        .then(function (res) {
            let data = JSON.parse(res.data);

            if ( data.status == 201 ) {
                $f7.dialog.alert('Data Menu berhasil diubah');

                $f7router.navigate('/home-dapur/',{reloadCurrent  : true});
            }
        });
        
    }
    

    $on('pageInit', (e) => {
        // get daftar_menu belum siap
        $store.dispatch('getMenuBelumSiap');
    });

    return $render;
}
</script>